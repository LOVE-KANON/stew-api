<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.stew.core.api.usecase.mapper.AuthMapper">

    <select
        id="getMaxSeqAuthUser"
        parameterType="com.example.stew.core.api.resource.entity.CoreUserEntity"
        resultType="com.example.stew.core.api.resource.entity.CoreUserEntity">
        select
            "USER_ID",
            "USER_SEQ",
            "JOINED_DATE",
            "RETIRED_DATE",
            "SEI",
            "MEI",
            "MAIL_ADDRESS",
            "PASSWORD",
            "POSITION",
            "LAST_LOGIN",
            "CREATE_USER",
            "CREATE_AT",
            "UPDATE_USER",
            "UPDATE_AT",
            "DELETE_FLG",
            "VERSION"
        from
            "CORE_USER" cu
        <where>
            and "MAIL_ADDRESS" = #{mailAddress}
            and cu."USER_SEQ" =
                (
                    select max(cu_max_seq."USER_SEQ")
                    from "CORE_USER" cu_max_seq
                    where cu_max_seq."USER_ID" = cu."USER_ID"
                )
        </where>
    </select>

</mapper>
